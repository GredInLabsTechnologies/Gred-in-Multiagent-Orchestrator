============================= test session starts =============================
platform win32 -- Python 3.12.10, pytest-8.4.1, pluggy-1.6.0
rootdir: C:\Users\shilo\Documents\GitHub\Gred-Repo-Orchestrator
plugins: anyio-4.10.0, asyncio-1.1.0, cov-6.2.1
asyncio: mode=Mode.STRICT, asyncio_default_fixture_loop_scope=None, asyncio_default_test_loop_scope=function
collected 124 items

tests\unit\test_config.py ...F                                           [  3%]
tests\unit\test_file_service.py ......                                   [  8%]
tests\unit\test_git_service.py .....                                     [ 12%]
tests\unit\test_main.py .F....                                           [ 16%]
tests\unit\test_repo_service.py .......                                  [ 22%]
tests\unit\test_routes.py ..................................             [ 50%]
tests\unit\test_security_core.py .................                       [ 63%]
tests\unit\test_security_validation.py ................                  [ 76%]
tests\unit\test_services_remaining.py .................                  [ 90%]
tests\unit\test_system_service.py ............                           [100%]

================================== FAILURES ===================================
_________________________ test_token_file_read_error __________________________

tmp_path = WindowsPath('C:/Users/shilo/AppData/Local/Temp/pytest-of-shilo/pytest-35/test_token_file_read_error0')

    def test_token_file_read_error(tmp_path):
        token_file = tmp_path / ".token"
        token_file.mkdir() # Causes read error
        with patch('tools.repo_orchestrator.config.ORCH_TOKEN_FILE', token_file):
            with patch.dict(os.environ, {"ORCH_TOKEN": ""}):
>               token = _load_or_create_token()
                        ^^^^^^^^^^^^^^^^^^^^^^^

tests\unit\test_config.py:35: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
tools\repo_orchestrator\config.py:84: in _load_or_create_token
    ORCH_TOKEN_FILE.write_text(token, encoding="utf-8")
C:\Program Files\WindowsApps\PythonSoftwareFoundation.Python.3.12_3.12.2800.0_x64__qbz5n2kfra8p0\Lib\pathlib.py:1047: in write_text
    with self.open(mode='w', encoding=encoding, errors=errors, newline=newline) as f:
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = WindowsPath('C:/Users/shilo/AppData/Local/Temp/pytest-of-shilo/pytest-35/test_token_file_read_error0/.token')
mode = 'w', buffering = -1, encoding = 'utf-8', errors = None, newline = None

    def open(self, mode='r', buffering=-1, encoding=None,
             errors=None, newline=None):
        """
        Open the file pointed to by this path and return a file object, as
        the built-in open() function does.
        """
        if "b" not in mode:
            encoding = io.text_encoding(encoding)
>       return io.open(self, mode, buffering, encoding, errors, newline)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E       PermissionError: [Errno 13] Permission denied: 'C:\\Users\\shilo\\AppData\\Local\\Temp\\pytest-of-shilo\\pytest-35\\test_token_file_read_error0\\.token'

C:\Program Files\WindowsApps\PythonSoftwareFoundation.Python.3.12_3.12.2800.0_x64__qbz5n2kfra8p0\Lib\pathlib.py:1013: PermissionError
______________________ test_panic_mode_check_middleware _______________________

auth_client = <starlette.testclient.TestClient object at 0x00000250CB5BA9F0>

    def test_panic_mode_check_middleware(auth_client):
        with patch('tools.repo_orchestrator.main.load_security_db', return_value={"panic_mode": True}):
            response = auth_client.get("/ui/repos")
>           assert response.status_code == 503
E           assert 200 == 503
E            +  where 200 = <Response [200 OK]>.status_code

tests\unit\test_main.py:33: AssertionError
----------------------------- Captured log setup ------------------------------
INFO     orchestrator:main.py:35 Starting Repo Orchestrator...
------------------------------ Captured log call ------------------------------
INFO     httpx:_client.py:1025 HTTP Request: GET http://testserver/ui/repos "HTTP/1.1 200 OK"
---------------------------- Captured log teardown ----------------------------
INFO     orchestrator:main.py:52 Shutting down Repo Orchestrator...
=============================== tests coverage ================================
______________ coverage: platform win32, python 3.12.10-final-0 _______________

Name                                                   Stmts   Miss  Cover   Missing
------------------------------------------------------------------------------------
tools\repo_orchestrator\__init__.py                        0      0   100%
tools\repo_orchestrator\config.py                         60      4    93%   10, 20, 87-88
tools\repo_orchestrator\main.py                          112     14    88%   38-39, 85, 109-110, 124, 134-136, 165-166, 191, 196-198
tools\repo_orchestrator\models.py                         23      0   100%
tools\repo_orchestrator\routes.py                        172      0   100%
tools\repo_orchestrator\security\__init__.py              12      0   100%
tools\repo_orchestrator\security\audit.py                 26      0   100%
tools\repo_orchestrator\security\auth.py                  26      0   100%
tools\repo_orchestrator\security\common.py                15      0   100%
tools\repo_orchestrator\security\rate_limit.py            26      0   100%
tools\repo_orchestrator\security\validation.py            65      0   100%
tools\repo_orchestrator\services\file_service.py          33      0   100%
tools\repo_orchestrator\services\git_service.py           24      0   100%
tools\repo_orchestrator\services\repo_service.py          93      1    99%   95
tools\repo_orchestrator\services\snapshot_service.py      46      0   100%
tools\repo_orchestrator\services\system_service.py        53      0   100%
tools\repo_orchestrator\test_app.py                        7      7     0%   1-16
------------------------------------------------------------------------------------
TOTAL                                                    793     26    97%
=========================== short test summary info ===========================
FAILED tests/unit/test_config.py::test_token_file_read_error - PermissionErro...
FAILED tests/unit/test_main.py::test_panic_mode_check_middleware - assert 200...
======================== 2 failed, 122 passed in 1.77s ========================
