============================= test session starts =============================
platform win32 -- Python 3.12.10, pytest-8.4.1, pluggy-1.6.0 -- C:\Users\shilo\AppData\Local\Microsoft\WindowsApps\PythonSoftwareFoundation.Python.3.12_qbz5n2kfra8p0\python.exe
cachedir: .pytest_cache
rootdir: C:\Users\shilo\Documents\GitHub\Gred-Repo-Orchestrator
plugins: anyio-4.10.0, asyncio-1.1.0, cov-6.2.1
asyncio: mode=Mode.STRICT, asyncio_default_fixture_loop_scope=None, asyncio_default_test_loop_scope=function
collecting ... collected 6 items

tests/unit/test_repo_service.py::test_list_repos PASSED                  [ 16%]
tests/unit/test_repo_service.py::test_ensure_repo_registry FAILED        [ 33%]
tests/unit/test_repo_service.py::test_vitaminize_repo PASSED             [ 50%]
tests/unit/test_repo_service.py::test_walk_tree PASSED                   [ 66%]
tests/unit/test_repo_service.py::test_perform_search PASSED              [ 83%]
tests/unit/test_repo_service.py::test_search_in_file_error PASSED        [100%]

================================== FAILURES ===================================
__________________________ test_ensure_repo_registry __________________________

mock_save = <MagicMock name='save_repo_registry' id='2462535812112'>
mock_load = <MagicMock name='load_repo_registry' id='2462535820656'>

    @patch('tools.repo_orchestrator.services.repo_service.load_repo_registry')
    @patch('tools.repo_orchestrator.services.repo_service.save_repo_registry')
    def test_ensure_repo_registry(mock_save, mock_load):
        mock_load.return_value = {"active_repo": "/old/active", "repos": ["/path/old"]}
        repos = [RepoEntry(name="new", path="/path/new")]
    
        registry = RepoService.ensure_repo_registry(repos)
        # Normalize paths for comparison
        registry_repos = [str(Path(p)) for p in registry["repos"]]
>       assert str(Path("/path/new")) in registry_repos
E       AssertionError: assert '\\path\\new' in ['\\path\\old', 'C:\\path\\new']
E        +  where '\\path\\new' = str(WindowsPath('/path/new'))
E        +    where WindowsPath('/path/new') = Path('/path/new')

tests\unit\test_repo_service.py:34: AssertionError
=========================== short test summary info ===========================
FAILED tests/unit/test_repo_service.py::test_ensure_repo_registry - Assertion...
========================= 1 failed, 5 passed in 0.44s =========================
